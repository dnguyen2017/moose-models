---
title: "Burden-structured population models for moose"
author: "David Nguyen"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
source("moose_calculations.R")
harvest_df <- read_csv("data/harvest_sensitivity_output.csv")

# params for moose survival
moose.params <- c("surv.int" = unname(coef(surv.glm)[1]),
                "surv.slope" = unname(coef(surv.glm)[2])
                )
# note, calves.multi is the multinomial regression model for the calving function

tick.params <- c("pEF" = 0.5,      # proportion of tick load that becomes engorged female
                 "t.surv" = 0.5,   # tick survival 
                 "l.surv" = 0.3,   # larval survival
                 "no.eggs" = 5000, # eggs per EF
                 "maxMu" = 50,     # maximum mean of the burden dist'n. In thousands of ticks.
                 "saturationRate" = 10^9 # how quickly mu(larvae) -> maxMu
                 )
```

## Purpose

Models can be useful for evaluating the potential of alternative wildlife management strategies to meet management goals. Here, I propose an extension of matrix models that can be used to determine how harvesting might be used to control winter tick outbreaks among moose populations. The key difference between this model and previous models used for moose populations is that this model incorporates mechanistic relationships between the dynamics of tick populations and moose populations. This model feature is necessary to evaluate how harvesting might control tick outbreaks by reducing moose populations. Without having to assume that a moose population thresholds for tick persistence exist, I find preliminary theoretical evidence that harvesting moose can control winter tick outbreaks.

<!-- A modeling framework that can be used to evaluate how moose harvesting impacts winter tick outbreaks would be useful for assessing outcomes of proposed management actions. To model the potential impacts of harvesting on tick outbreaks we must model the interactions and feedbacks between the population dynamics of moose and the population dynamics of ticks. The inclusion of this interaction between moose and ticks will allow us to mechanistically model how increased harvests could influence tick outbreak frequency and severity. Models that don’t include the mechanisms that connect the effect of moose abundance on tick recruitment cannot be used to assess the impact of harvesting on tick outbreaks since these models have no link between moose density and tick population size/distribution among moose. -->

In the following sections I describe the rationale and structure of the proposed model, data requirements for estimation of model parameters, and examples of model output under different harvesting strategies.

## Rationale for burden-structured model

The simplest population models describe how population-average birth and death rates dictate changes in a population over time. However, variation between individuals causes variation in survival and reproduction (vital rates) among individuals. For instance, vital rates of a particular animal may depend on characteristics like stage (e.g., calf, yearling, adult), age, and/or size. This is the motivation behind matrix population models which “structure” populations into discrete classes based on a variable like stage. By accounting for realistic variation, structured models be connected to empirical data and generate more accurate projections. 

Since tick-burden varies among moose, the impact of ticks on moose's survival and reproduction depends on how infested it is. Structured populations models allow use to account for this important source of variation since we can structure moose populations by their tick-burden. Burden-structured models make it possiblee to connect moose and tick population dynamics. This is because the expected recruitment of questing larval is determined by the tick-burdens on moose which are explicitly accounted for in this model.

Overall, this approach will allow us to simultaneously account for the impact of variable tick burdens on moose vital rates and the joint impact of moose population size and tick burden distribution on tick recruitment. This is critical for understanding how harvesting might alter tick outbreaks. Moreover, modelling results will be easier to interpret for moose researchers and managers since burden-structured models share the ideas underlying the matrix population models commonly used in moose population assessment.

## Model structure and assumptions

The model tracks two state variables over time, the abundance of ticks in the environment (questing larvae) and numbers of adult moose cows. Events in the model follow a simplified version of the annual sequence of interactions between moose and winter ticks. The following five events happen within each annual time step of the model.

1. *Moose acquire ticks from the environment.* 
    + The resulting distribution of burdens is assumed to be have a negative binomial distribution; the negative binomial distribution is used to because it allows for overdispersion which is common for parasites like ticks (Shaw and Dobson, 1999). 
    + The mean of the burden distribution was assumed to increase with questing larval abundance, i.e., if there are many questing larvae in the environment moose will acquire more ticks which increases the average tick-burden among the moose population. 

2. *A proportion of moose is harvested.* 
    + The probability of being harvested is assumed to be independent of burden. 

3. *Moose die from natural mortality or tick feeding.* 
    + There is a constant probability of dying from non-tick related causes.
    + Ticks affect the probability of dying additively.

4. *Ticks detach from moose and lay eggs.* 
    + The expected proportion of ticks that are engorged females lay eggs. Of the laid eggs, some proportion succesfully eclose and will be recruited as questing larvae in the subsequent year.

5. *Moose give birth to calves (only female calves are tracked).* 
    + Note, this current model does not include stage-structure, so moose are immediatly recruited into the adult class.
    + Moose recruitment is currently density-independent in this model, so moose population in this model grows or declines exponentially when ticks are absent.

<!-- insert image of model structure here -->

<!-- Mathematical details of the model are in the appendix. -->

## Data requirements

To model both tick and moose population dynamics we need to know three properties of this host-parasite system:

1. *How variation in tick burden affects moose survival and reproduction.*

This can be determined from measurements of tick-burden, survival, and reproduction of individuals over time by regressing tick-burden onto survival and calving. These estimates can then be used to construct population projection matrices for the burden-structured model. An example of this is shown in the following section for simulated data.

2. *The expected number of larval ticks recruited per moose with a certain tick-burden.*

Previous work on tick recruitment (Addison ; Samuel) could be used to to inform estimates of larval tick recruitment. While the studies tend to be small, and have little replication or control, they will still be useful as priors for Bayesian estimation of parameters.
    
<!-- it may be possible to also estimate these params during model fitting to time series data -->

3. *How density/abundance of questing larvae impacts the acquisition and distribution of tick burdens among moose.* 

This is the most challenging question to answer, but is critical for modeling tick epidemiology. Parameters for this process may be estimated given longitudinal data of moose population abundances and "snapshots" of tick burdens over time. That is, tick counts from harvested moose and/or winter-kill. By combining these data with the proposed burden-structured model, it may be possible to determine tick transmission parameters using Bayesian hierarchical modeling (Hobbs and Hooten). This would require further development of some previous work on estimating parameters for structured population models (Ghosh et al.). Developing parameter estimation methods from these data for burden-structured models would be an important advance for disease ecology since many human and agricultural diseases have burden-dependent pathology and "snapshot" types of data.

<!-- The model can be parameterized from individual- or population-level data. --> 

<!-- Another type of data that would be useful is longitudinal data of moose population abundances and "snapshots" of tick burdens over time. That is, tick counts from harvested moose and/or winter-kill. By combining these data with the proposed burden-structured model, it may be possible to determine tick transmission parameters using Bayesian hierarchical modeling approaches (Hobbs and Hooten). This would require further development of some previous work on estimating parameters for structured population models (Ghosh et al.) and would be an important contribution for modeling diseases. -->

## Parameterization

### Estimating impact of tick-burden on survival and calving

I use a simulated data set to demonstrate how parameters could be estimated from individual-level observations of cow moose. The data set consists of measurements of tick-burden, survival, and calving. Tick burden was simulated following a negative binomial distribution (mean = 33,000 ticks/moose, dispersion parameter (k) = 3). Modeling burden as negative binomial distributed is supported by previous work on parasite aggregation (Shaw and Dobson, 1999). The parameters were chosen to qualitatively match a histogram of winter tick burdens among moose presented by Samuel (2004). Each of the moose in the simulated data set were then assigned a survival outcome and number of calves produced. Survival outcomes and number of calves were assigned from binomial and multinomial distributions, respectively. Probabilities of survival and calving were assumed to be decreasing functions of tick burden. 

Parameter estimates were obtained from the simulated data by regressing survival or number of calves onto moose burden. I used logistic regression to estimate survival probabilities and multinomial regression to estimate the expected number of calves. The parameter estimates were used to parameterize projection matrices for the burden-structured model. The simulated data and model fits for the data are shown in the following figures.

```{r burden_histogram }
# Hist presented in Samuel 2004 looks similar to mine.
hist(moose_data$burden, breaks = seq(0, 140000, 10000),
     main = "Simulated distribution of tick burdens on moose",
     xlab = "Tick burden",
     ylab = "Number of moose")

```

```{r survival_fit}
# compare actual outcomes with model fits
plot(survival ~ burden, data = moose_data, ylab = "survival outcome or probablity", xlab = "tick burden", main = "Simulated survival data and model fit")
lines(predict.glm(surv.glm, tibble(burden = 0:140000), type = "response"), col = "red")
legend("topright", legend = c("observed survival","estimated survival probability"), col = c("black","red"), lty = c(NA,1), pch = c(1,NA))

```

```{r calving_fit}
# compare predicted female recruitment with actual data
pred_recr = tibble(burden = 0:140000, recruitment = recr.x.vector(burden, calves.multi))

plot((calves) ~ burden, moose_data, ylab = "female calf recruitment", xlab = "tick burden", main = "Simulated calf recruitment data and model fits", col = "black")
# points((0.5 * calves) ~ burden, data, col = "red")
lines(pred_recr, col = "red", lty = 2)
lines( (2*recruitment) ~ burden, pred_recr, col = "blue")
legend("topright", legend = c("observed recruitment","predicted total recr.", "predicted female recr."), col = c("black","blue","red"), lty = c(NA,1,2), pch = c(1,NA,NA))
```

### Parameters for larval tick recruitment

To determine the number of larvae that are recruited from each moose, we need to take the product of the following quantities: the proportion of ticks on a moose that are engorged females, the average number of eggs each engorged female lays, and the expected proportion of those eggs from which larvae eclose and survive until the fall questing season. For the model shown here, I assumed that 25 % of the ticks on a moose survived to become engorged females based on point estimate reported by Samuel (2004). These surviving engorged females each lay an expected $5,000$ eggs which is the upper-bound of winter tick egg-laying (Drummond et al., 1969). I arbitrarily set larval eclosion and survival at 30 % of total eggs, since the controlled studies I have read did not measure eclosion success. These rough estimates and assumptions result in 375 larvae recruited per infesting tick. Below is a plot showing how larval recruitment per moose increases with the moose's tick-burden.

Note that I'm assuming that larval recruitment is density-independent. That is, there is no difference when comparing the expected number of larvae produced from an engorged female tick from a lightly-infested moose to one from a heavily-infested moose.  Previous work has shown no evidence of density-dependence for tick-burdens ranging between 20,000-40,000 (), however, this may not be true when infestations are heavier. The assumption of density-independent larval recruitment may bias the model by making tick control harder to achieve.

```{r tick_recr_plot}
tick_recr <- tick.recr.x(seq(0, 50000, 1000),
                         tick.params)
plot(tick_recr ~ seq(0, 50000, 1000),
     main = "Larvae produced from a single moose",
     ylab = "larval recruitment",
     xlab = "tick-burden of a moose")
```

### Parameters for tick-attachment to moose

For the tick-attachment process there are at least 3 parameters that need to be estimated. The first two are the mean and shape parameters of the negative binomial distribution which controls the distribution of ticks among moose in this model. At least one or more additional parameters is needed to describe the relationship between the abundance of questing larvae in the environment and the mean tick-burden. For the model shown here, I assume a simple functional form which only has one additonal parameter. The assumed function is shown in the plot below. I have not yet developed the statistical methods for estimating these three parameters (as described in the *Data Requirements* section) nor have have I found estimates in the literature, so, I just chose values that seemed reasonable based on model output.

```{r acquisition_func_plot}
mean_burdens <- getMu(seq(0, 2*10^9, 10^5) , max = 50, satrate = 10^9)
plot(mean_burdens ~ seq(0, 2*10^9, 10^5),
     main = "Response of moose tick-burden to abundance of questing larvae",
     ylab = "mean tick-burden (thousands of ticks)",
     xlab = "abundance of questing larvae")
```

## Model output example

In this section, I present some model projections for different levels of harvesting. These projections use the model structure, assumptions, and parameterizations presented above. Of course, it wouldn't be appropriate to make any claims about how harvesting might impact an actual moose-tick system until the model is parameterized with real data. However, these theoretical results demonstrate the potential applications of this model when parameterized with real data to assess alternative harvesting strategies for controlling winter tick outbreaks.

In all simulations I initialize the system with $10^6$ questing larvae and $100$ moose. I then examined how different proportions of constant harvesting impacted moose populations and tick persistence. In the following figures the abundances of questing larvae are presented in the top row and moose abundance in the bottom row. The columns in each plot are the different proportional annual harvest rates for moose, e.g., 0.1 means that a 10 % annual moose harvest was used in the simulation.


```{r no_harvest}
filter(harvest_df, harvest == 0.0) %>%
  ggplot() +
  geom_point(aes(x = t, y = abundance)) +
  facet_wrap(~spp, nrow = 2, scales = "free") +
  labs(title = "Dynamics of unharvested moose-tick system",
       x = "years")
```

In the absence of harvesting, moose can be stably regulated by winter ticks. The transient "spikes" in both tick and moose abundance are artifacts caused by the assumption of density-independent moose population growth. At the beginning of the simulation, there are too few ticks to regulate moose so they grow exponentially until tick burdens become heavy enough to regulate moose population growth.

```{r coexistence}
# when moose are regulated by ticks
h_regulated <- c(0.2, 0.3)
harvest_df %>%
  filter(round(harvest,1) %in% h_regulated) %>% # need to round harvest variable due to numerical differences (not sure why they popped up)
  ggplot() + geom_point(aes(x = t, y = abundance)) +
  facet_grid(spp ~ harvest, scales = "free") +
    labs(title = "Low harvests allow for moose-tick coexistence",
       x = "years")
```

At low levels of harvest ($0 <harvest \leq 0.3$) the results are similar to the no harvest strategy. The main difference is that moose and ticks coexist at lower abundances than the unharvested case. These low levels of harvest also produced damped oscillations in moose and tick abundances which indicates that harvesting is destabilizing.

```{r controlled}
# when ticks are wiped out
h_controlled <- c(0.4, 0.5)
harvest_df %>%
  filter(round(harvest,1) %in% h_controlled) %>% # need to round harvest variable due to numerical differences (not sure why they popped up)
  ggplot() + geom_point(aes(x = t, y = abundance)) +
  facet_grid(spp ~ harvest, scales = "free") +
    labs(title = "Higher harvests control ticks",
       x = "years")
```

At higher levels of harvest ($0.3 < harvest \leq 1$) both moose and ticks populations decline to zero. But, notice that for intermediate harvesting intensities (0.4 and 0.5)  ticks died out sooner than the moose. This indicates that harvesting can theoretically be used to control winter ticks. This result is an emergent property of the feedback between moose population size and tick recruitment. Since constant harvesting strategies caused extirpation of both moose and ticks, it would be useful to model harvesting strategies that varied with time or were dependent on moose population size.

Using time- or state-dependent harvesting to control tick outbreaks by dynamically regulating moose populations was already proposed by Samuel (2004). However, the success of this approach depends on knowing the critical thresholds where tick outbreaks can occur so that moose populations can be managed below it. By parameterizing the burden-structured models I developed here with field data, it may be possible to estimate the critical moose population thresholds for winter tick outbreaks in a way similar to how herd-immunity thresholds are estimated for vaccine-preventable human diseases. Dynamic optimization methods (stochastic dynamic programming) could be then used to develop state-dependent harvesting strategies to meet specific management objectives.


<!-- stop knitting here -->
`r knitr::knit_exit()`

<!-- ## Supplementary tables -->

```{r equil_tbl}
harvest_df %>% filter(harvest < 0.4) %>%
  group_by(harvest,t) %>%
  pivot_wider(names_from = spp,
              values_from = abundance) %>%
  ungroup(t) %>%
  top_n(1, t) %>%
  select(-1) %>% signif(3) %>%
  knitr::kable(digits = 2)
```

When moose and ticks coexist, harvesting decreases both moose and tick population abundances at equilibrium.

```{r}
tick_threshold <- 50 # when ticks are considered wiped out
harvest_df %>% 
  group_by(harvest,t) %>%
  pivot_wider(names_from = spp,
              values_from = abundance) %>%
  ungroup(t) %>%
  filter(larvae <= tick_threshold) %>%
  group_by(harvest) %>%
  top_n(-1, # take first t where larvae are extirpated
        wt = t) %>% # variable to take
  knitr::kable(digits = 3)

```

Higher rates of harvesting pushes both moose and ticks to extinction. At intermediate levels of harvest, tick populations decrease faster than the moose population declines. Therefore, using state-dependent harvest intensities may be a feasible approach to winter tick management.